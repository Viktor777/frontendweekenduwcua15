<section class="slide">
    <h1>Web Speech API</h1>
    <label for="input-19">Пожалуйста, поговори со мной</label> <input type="text" id="input-19" class="input">
    <pre><code class="javascript" contenteditable="true">
var utterance = new SpeechSynthesisUtterance();

utterance.lang = "ru";
utterance.text = "Привет";
speechSynthesis.speak(utterance);
...
var recognizer = new SpeechRecognition();

recognizer.addEventListener('result', function (event) {
    for (var i = event.resultIndex; i < event.results.length; i++) {
        if (event.results[i].isFinal) {
            console.log(event.results[i][0].transcript);
        }
    }
});
recognizer.start();
    </code></pre>
</section>
<script type="text/javascript">

    if (!fwuwcua15.hasOwnProperty('SpeechAPI')) {
        fwuwcua15.SpeechAPI = (function () {

            'use strict';

            function SpeechAPI(id, lang) {
                this.el = document.getElementById(id);
                this.label = document.querySelector('[for="' + id + '"]');
                this.lang = lang;

                this.label.addEventListener('click', function (event) {
                    this.speak(event.target.textContent || event.target.innerText)
                        .then(function () {
                            return this.recognize()
                                    .then(function (text) {
                                        this.el.value = text;
                                    }.bind(this));
                        }.bind(this));
                }.bind(this), false);
            }

            SpeechAPI.prototype = {
                speak: function(text) {
                    return new Promise(function(resolve, reject) {
                        if (!SpeechSynthesisUtterance) {
                            reject('API not supported');
                        }
                        this.utterance = new SpeechSynthesisUtterance(text);

                        this.utterance.lang = this.lang;
                        this.utterance.addEventListener('end', function() {
                            console.log('Synthesizing completed');
                            resolve();
                        });

                        this.utterance.addEventListener('error', function (event) {
                            console.log('Synthesizing error');
                            reject('An error has occurred while speaking: ' + event.error);
                        });

                        console.log('Synthesizing the text: ' + text);
                        speechSynthesis.speak(this.utterance);
                    }.bind(this));
                },
                recognize: function() {
                    return new Promise(function(resolve, reject) {
                        var SpeechRecognition = SpeechRecognition || webkitSpeechRecognition || null;

                        if (SpeechRecognition === null) {
                            reject('API not supported');
                        }
                        this.recognizer = new SpeechRecognition();

                        this.recognizer.addEventListener('result', function (event) {
                            console.log('Recognition completed');
                            for (var i = event.resultIndex; i < event.results.length; i++) {
                                if (event.results[i].isFinal) {
                                    resolve(event.results[i][0].transcript);
                                }
                            }
                        });

                        this.recognizer.addEventListener('error', function (event) {
                            console.log('Recognition error');
                            reject('An error has occurred while recognizing: ' + event.error);
                        });

                        this.recognizer.addEventListener('nomatch', function () {
                            console.log('Recognition ended because of nomatch');
                            reject('Error: sorry but I could not find a match');
                        });

                        this.recognizer.addEventListener('end', function () {
                            console.log('Recognition ended');
                            reject('Error: sorry but I could not recognize your speech');
                        });

                        console.log('Recognition started');
                        this.recognizer.start();
                    }.bind(this));
                }
            };

            return SpeechAPI;
        })();
    }

    new fwuwcua15.SpeechAPI('input-19', 'ru');

</script>